---
layout: post
date: 2024-08-25
title: "CTFd 를 이용한 워게임 사이트 만들기(1) - CTFd 실행"
tags: [ubuntu, CTF, wargame, dev, ]
categories: [DevOps, ]
---


> 💡 **info**  
> - 작성 날짜 : 2024.08.25  
>   
> - 실습 OS : ubuntu 20.04.6 LTS

	- 작성 날짜 : 2024.08.25
	- 실습 OS : ubuntu 20.04.6 LTS

## 개요


방학동안 동아리 워게임 사이트를 만드려고 했다가 미루고 미뤄서 이제서야 만들게 됐다..(너무 귀찮아)


워게임 사이트를 처음부터 혼자 다 만드는 것은 미친짓이기 때문에 최대한 빠르게 워게임 사이트를 만들기 위해 익히 들어왔던(하지만 한번도 써본적은 없는) CTFd 를 사용하기로 했다.


## 개발 환경


워게임 사이트를 만들기 위해 필요한 자원(?)들은 다음과 같다.

- 호스팅 서버(머신)
- 워게임 사이트
- 워게임 문제들

가장 머리 아픈 문제는 워게임 문제들을 어떻게 충당할 것인가… 인데 그런건 일단 나중에 생각하기로 했다.


호스팅 서버는 클라우드 서버가 아닌 동아리 서버를 사용할 것이다. 동아리 서버가 막 엄청나게 좋은 것은 아니지만, 가장 큰 장점은 **무료** 라는 것이다. (심지어 공인 아이피도 무료 ㄷㄷ) 


어차피 내가 졸업하면 직접적인 관리는 못하겠지만, 그건 나중에 누군가 하겠지…


마지막으로 워게임 사이트를 만들기 위해서 오픈소스 CTF 사이트 구축 툴인 CTFd를 사용할 것이다.


[bookmark](https://github.com/CTFd/CTFd)


## 과정


자 먼저 워게임 사이트 생성을 위해 서버에 우분투를 설치해야된다..!! 는 구라고 손쉬운 관리를 위해 CTFd 전용 계정을 생성해 줄 것이다.


근데 우분투 설치 이후에 아무것도 안해놔서 사실상 OS 설치 제외하고 진짜 처음부터 하는 느낌…


### CTFd 관리를 위한 호스트 계정 생성


`adduser` 명령어를 사용해서 사이트 관리를 위한 호스트 계정을 생성한다. 계정이름은 아무렇게나 해도 되지만 나는 `ctfd` 로 했다.


{% raw %}
```bash
$ sudo adduser ctfd
Adding user `ctfd' ...
Adding new group `ctfd' (1002) ...
Adding new user `ctfd' (1002) with group `ctfd' ...
Creating home directory `/home/ctfd' ...
Copying files from `/etc/skel' ...
New password:
Retype new password:
passwd: password updated successfully
Changing the user information for ctfd
Enter the new value, or press ENTER for the default
	Full Name []:
	Room Number []:
	Work Phone []:
	Home Phone []:
	Other []:
Is the information correct? [Y/n] y
```
{% endraw %}


이후에 생성된 ctfd 계정으로 전환한 후, 여러가지 패키지를 설치할려고 했지만 나는 sudo 권한이 없단다…


sudo 사용을 위해 ctfd 계정을 sudo 그룹으로 추가해주자


{% raw %}
```bash
sudo usermod -aG sudo ctfd
```
{% endraw %}


### 패키지 설치


계정이 생성됐으므로 이제 본격적으로 ctfd를 설치해보자


ctfd 설치에 어떤 패키지가 필요한지는 모르겠지만 일단 apt 업데이트는 당연히 필요할 것이기 때문에 미리 업데이트!!


{% raw %}
```bash
sudo apt-get update && sudo apt-get upgrade -y
```
{% endraw %}


이제 진짜 ctfd를 설치해야되므로 어떤 패키지가 필요한지 알아보기 위해 공식 깃허브를 확인해보자


![0](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/0.png)


..?


ctfd 설치를 위해 필요한 패키지는 파이썬 뿐이다.(ctfd 플라스크로 만든거였어..?)


도커를 사용한 설치 방법도 있긴 하지만 나중에 추가 기능이 필요한 상황이나 포트포워딩 할 때 귀찮아질 것 같아서 파이썬을 이용한 로컬 설치를 진행하겠다. (수틀리면 나중에 도커로 하면 되지 ㅋㅋ)

- 파이썬 설치

일단 파이썬을 설치해보자


![1](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/1.png)


CTFd 업데이트가 비교적 최근에 된 것 같아서 굳이 파이썬 버전을 따로 맞춰주지 않고 `apt-get install python3` 로 설치했다.


{% raw %}
```bash
sudo apt-get install python3 python3-pip -y
```
{% endraw %}


혹시 특정 파이썬 버전 쓰고 싶으신 분들은 아래 코드로…


{% raw %}
```bash
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt install python3.*
```
{% endraw %}


파이썬 설치 확인


![2](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/2.png)


~~어… 딱히 파이썬 버전 신경쓰지는 않았는데 생각보다 낮은 버전이 깔렸네..?~~ OS 버전이 24.04 인줄 알았는데 20.04 였다 ㅋㅋㅋㅋㅋㅋㅋㅋㅋ


그리고 생각해보니까 깃 저장소 받아오려면 git 도 필요하다. (로컬에 파일 다운받고 scp 사용해서 원격 서버로 옮길 수는 없잖아..)

- git 설치

{% raw %}
```bash
sudo apt-get install git -y
```
{% endraw %}


### CTFd 설치


CTFd 실행을 위한 위한 패키지를 모두 설치했으므로 이제 소스 코드 다운받고 한번 실행해보자


(소스코드 다운받는 중)


{% raw %}
```bash
cd ~
git clone https://github.com/CTFd/CTFd.git
```
{% endraw %}


![3](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/3.png)


(파이썬 의존선 패키지 다운받는 중)


{% raw %}
```bash
pip install -r requirement.txt
```
{% endraw %}


대망의 CTFd 실행!!


{% raw %}
```bash
python3 server.py
```
{% endraw %}


![4](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/4.png)


![5](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/5.png)


않이…


이게 방화벽 때문에 막히는 건지, 진짜 외부로 연결이 안된건지 몰라서 예정에도 없던 추가 분석을 하게 되었다.


먼저 문서 내용 확인을 위해 vim 설치 및 .vimrc 설정

- vim 설치

{% raw %}
```bash
sudo apt-get install vim -y
```
{% endraw %}

- .vimrc 수정

{% raw %}
```bash
vim ~/.vimrc
```
{% endraw %}


{% raw %}
```bash
set number
set ai
set si
set cindent
set shiftwidth=4
set tabstop=4
set ignorecase
set hlsearch
set nocompatible
set fileencodings=utf-8,euc-kr
set fencs=ucs-bom,utf-8,euc-kr
set bs=indent,eol,start
set ruler
set title
set showmatch
set wmnu
color elflord
syntax on
filetype indent on
set mouse=a
```
{% endraw %}

- `server.py` 내용 확인

![6](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/6.png)


다행히 학교 방화벽에 걸린 건 아니었고, 서버 기본 설정이 로컬 호스트로 설정되어 있어서 외부에서 접속이 안되던거였다. (당연히 외부로 연결되야되는거 아니냐고… )


43번째 줄에서 host를 0.0.0.0으로 수정한 후 다시 접속해보자


![7](/assets/img/2024-08-25-CTFd-를-이용한-워게임-사이트-만들기(1)---CTFd-실행.md/7.png)


(편안…)


이후 추가 설정은 언제 작성할지 모를 다음 포스터에서 하도록 하겠다. ㅎㅎ 


## Reference


[link_preview](https://github.com/CTFd/CTFd)

